<div class="page">
  <header class="page__header">
    <div>
      <p class="page__eyebrow">Access control</p>
      <h1 class="page__title">Roles &amp; Permissions</h1>
      <p class="page__subtitle">
        Manage procurement roles, assign menu access, and create new roles with the right level of privileges.
      </p>
      <div class="main-role">Main role: {{ mainRole }}</div>
    </div>
    <button type="button" class="btn btn--primary" (click)="openModal()">Add New Role</button>
  </header>

  <section>
    <div class="section__header">
      <div>
        <p class="overline">Roles list</p>
        <h2 class="section__title">A role provides access to predefined menus and features</h2>
        <p class="muted">Depending on assigned role an administrator can tune what each user can do.</p>
      </div>
    </div>

    <div class="roles-grid">
      <article class="card role-card" *ngFor="let role of roles; trackBy: trackByRole">
        <div class="role-card__meta">
          <p class="muted">Total {{ role.users }} users</p>
          <span class="pill" *ngIf="role.badge">{{ role.badge }}</span>
        </div>
        <h3 class="role-card__title">{{ role.name }}</h3>
        <div class="avatar-group" *ngIf="role.avatars.length">
          <span class="avatar" *ngFor="let avatar of role.avatars">{{ avatar }}</span>
          <span class="avatar avatar--extra" *ngIf="role.extraUsers">+{{ role.extraUsers }}</span>
        </div>
        <div class="role-card__actions">
          <a class="link" href="javascript:void(0)" (click)="openModal()">Edit Role</a>
          <button type="button" class="icon-button" aria-label="Copy role">
            <span class="icon-button__square"></span>
          </button>
        </div>
      </article>

      <article class="card role-card role-card--new" (click)="openModal()">
        <div class="role-card__meta">
          <p class="muted">Add New Role</p>
        </div>
        <div class="empty-illustration">+</div>
        <p class="muted">Add new role, if it doesn't exist.</p>
      </article>
    </div>
  </section>
</div>

<div class="roles-modal-backdrop" *ngIf="showAddRoleModal">
  <div class="roles-modal" role="dialog" aria-modal="true" aria-labelledby="addRoleTitle">
    <header class="roles-modal__header">
      <div>
        <p class="overline">Set role permissions</p>
        <h3 class="roles-modal__title" id="addRoleTitle">Add New Role</h3>
      </div>
      <button type="button" class="icon-button" aria-label="Close" (click)="closeModal()">Ã—</button>
    </header>

    <form class="roles-modal__body" (ngSubmit)="submitRole()">
      <label class="field">
        <span class="field__label">Role Name</span>
        <input
          name="roleName"
          #roleNameInput
          [(ngModel)]="newRoleName"
          placeholder="Enter a role name"
          class="field__input"
          required
        />
      </label>

      <div class="permissions">
        <div class="permissions__controls">
          <label class="checkbox">
            <input
              #adminToggle
              type="checkbox"
              [checked]="adminAccess"
              (change)="onAdminAccessChange(adminToggle.checked)"
            />
            <span>Administrator Access</span>
          </label>
          <label class="checkbox">
            <input
              #selectAllToggle
              type="checkbox"
              [checked]="selectAllPermissions"
              (change)="toggleSelectAll(selectAllToggle.checked)"
            />
            <span>Select All</span>
          </label>
        </div>

        <div class="permissions__table" role="table">
          <div class="permissions__row permissions__row--head" role="row">
            <div class="permissions__cell permissions__cell--label" role="columnheader">Role Permissions</div>
            <div class="permissions__cell" role="columnheader">View</div>
            <div class="permissions__cell" role="columnheader">Edit</div>
            <div class="permissions__cell" role="columnheader">Create</div>
            <div class="permissions__cell" role="columnheader">Delete</div>
          </div>

          <div
            class="permissions__row"
            role="row"
            *ngFor="let permission of permissionRows; trackBy: trackByPermissionRow"
          >
            <div class="permissions__cell permissions__cell--label" role="cell">{{ permission.menu }}</div>
            <div class="permissions__cell" role="cell">
              <input
                #viewToggle
                type="checkbox"
                [checked]="permission.view"
                (change)="togglePermission(permission, 'view', viewToggle.checked)"
              />
              <span class="checkbox__label">View</span>
            </div>
            <div class="permissions__cell" role="cell">
              <input
                #editToggle
                type="checkbox"
                [checked]="permission.edit"
                (change)="togglePermission(permission, 'edit', editToggle.checked)"
              />
              <span class="checkbox__label">Edit</span>
            </div>
            <div class="permissions__cell" role="cell">
              <input
                #createToggle
                type="checkbox"
                [checked]="permission.create"
                (change)="togglePermission(permission, 'create', createToggle.checked)"
              />
              <span class="checkbox__label">Create</span>
            </div>
            <div class="permissions__cell" role="cell">
              <input
                #deleteToggle
                type="checkbox"
                [checked]="permission.delete"
                (change)="togglePermission(permission, 'delete', deleteToggle.checked)"
              />
              <span class="checkbox__label">Delete</span>
            </div>
          </div>
        </div>
      </div>

      <footer class="roles-modal__footer">
        <button type="submit" class="btn btn--primary">Submit</button>
        <button type="button" class="btn" (click)="closeModal()">Cancel</button>
      </footer>
    </form>
  </div>
</div>
