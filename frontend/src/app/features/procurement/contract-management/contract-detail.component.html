<div class="contract-detail" *ngIf="!loading && contract; else loadingStateTpl">
  <div class="top-bar">
    <button class="link" type="button" (click)="goBack()">‚Üê Back to Contract Management</button>
    <div class="top-meta">
      <div class="reference">Reference: <span>{{ referenceNumber }}</span></div>
      <span class="status-badge" [ngClass]="statusClass">{{ statusBadge }}</span>
    </div>
  </div>

  <div class="title-block">
    <div>
      <p class="eyebrow">Contract Overview</p>
      <h1>{{ contract.title }}</h1>
      <p class="muted">Created {{ formatDate(createdDate) }}</p>
    </div>
    <div class="amount-chip">
      <div class="label">Contract Value</div>
      <div class="value">{{ contract.contractValue | currency: currency }}</div>
    </div>
  </div>

  <div class="grid two-column">
    <div class="card">
      <div class="card-header">
        <div>
          <p class="eyebrow">Supplier</p>
          <h3>{{ contract.supplier.companyName }}</h3>
        </div>
        <span class="tag">ID: {{ contract.supplier.supplierUserId }}</span>
      </div>
      <div class="info-grid">
        <div>
          <p class="label">Contact person</p>
          <p class="value">{{ contract.supplier.contactName || 'Not provided' }}</p>
        </div>
        <div>
          <p class="label">Contact email</p>
          <p class="value">{{ contract.supplier.contactEmail || 'Not provided' }}</p>
        </div>
        <div>
          <p class="label">Phone</p>
          <p class="value">{{ contract.supplier.contactPhone || 'Not provided' }}</p>
        </div>
        <div>
          <p class="label">Address</p>
          <p class="value">{{ contract.supplier.companyAddress || 'Not provided' }}</p>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div>
          <p class="eyebrow">Issuing company</p>
          <h3>{{ contract.issuerCompany.name }}</h3>
        </div>
      </div>
      <div class="info-grid">
        <div>
          <p class="label">Address</p>
          <p class="value">{{ contract.issuerCompany.address }}</p>
        </div>
        <div>
          <p class="label">Email</p>
          <p class="value">{{ contract.issuerCompany.contactEmail }}</p>
        </div>
        <div>
          <p class="label">Phone</p>
          <p class="value">{{ contract.issuerCompany.contactPhone }}</p>
        </div>
        <div>
          <p class="label">Supplier</p>
          <p class="value">{{ supplierName }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="grid three-column">
    <div class="card">
      <div class="card-header">
        <p class="eyebrow">Contract status</p>
        <h3>Summary</h3>
      </div>
      <div class="stat-grid">
        <div>
          <p class="label">Value</p>
          <p class="value">{{ contract.contractValue | currency: currency }}</p>
        </div>
        <div>
          <p class="label">Currency</p>
          <p class="value">{{ currency }}</p>
        </div>
        <div>
          <p class="label">Reference</p>
          <p class="value">{{ referenceNumber }}</p>
        </div>
        <div>
          <p class="label">Created</p>
          <p class="value">{{ formatDate(createdDate) }}</p>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <p class="eyebrow">Timeline</p>
        <h3>Schedule</h3>
      </div>
      <div class="pill-list">
        <div class="pill">
          <span class="label">Start date</span>
          <span class="strong">{{ formatDate(startDate) }}</span>
        </div>
        <div class="pill">
          <span class="label">End date</span>
          <span class="strong">{{ formatDate(endDate) }}</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <p class="eyebrow">Signatures</p>
        <h3>Approvals</h3>
      </div>
      <div class="signature-block">
        <div class="signature-label">Supplier signature</div>
        <ng-container *ngIf="contract.supplierSignature; else pendingSupplierSignature">
          <img
            *ngIf="isImageSignature(contract.supplierSignature)"
            [src]="contract.supplierSignature"
            alt="Supplier signature"
            class="signature-image"
          />
          <div class="signature-text" *ngIf="!isImageSignature(contract.supplierSignature)">
            {{ contract.supplierSignature }}
          </div>
          <p class="muted">Signed on {{ formatDate(contract.supplierSignedAtUtc) }}</p>
        </ng-container>
        <ng-template #pendingSupplierSignature>
          <p class="muted">Awaiting supplier signature</p>
        </ng-template>
      </div>
      <div class="signature-block">
        <div class="signature-label">Issuer signature</div>
        <p class="muted">Not captured</p>
      </div>
    </div>
  </div>

  <div class="card line-items">
    <div class="card-header">
      <div>
        <p class="eyebrow">Contract scope</p>
        <h3>Line items</h3>
      </div>
      <div class="total">Total {{ totals.total | currency: currency }}</div>
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Description</th>
            <th>Qty</th>
            <th>Rate</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of lineItems">
            <td>{{ item.name }}</td>
            <td>{{ item.description }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.rate | currency: currency }}</td>
            <td>{{ item.total | currency: currency }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4">Subtotal</td>
            <td>{{ totals.subtotal | currency: currency }}</td>
          </tr>
          <tr>
            <td colspan="4">Tax</td>
            <td>{{ totals.tax | currency: currency }}</td>
          </tr>
          <tr>
            <td colspan="4" class="strong">Total</td>
            <td class="strong">{{ totals.total | currency: currency }}</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

<ng-template #loadingStateTpl>
  <div class="card loading">
    <p *ngIf="!missingContractMessage">Loading contract details...</p>
    <p *ngIf="missingContractMessage">{{ missingContractMessage }}</p>
  </div>
</ng-template>
