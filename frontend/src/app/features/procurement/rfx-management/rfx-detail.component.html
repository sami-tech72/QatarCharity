<div class="d-flex flex-column flex-column-fluid">
  <div id="kt_app_content" class="app-content flex-column-fluid">
    <div id="kt_app_content_container" class="app-container container-xxl">
      <div class="d-flex align-items-center mb-6">
        <a class="btn btn-light me-3" routerLink="/procurement/rfx-management">
          <i class="ki-duotone ki-arrow-left fs-3"></i>
          Back to RFx Management
        </a>
        <div>
          <h2 class="mb-0">RFx Details</h2>
          <div class="text-muted">Review the configuration and workflow for this RFx.</div>
        </div>
      </div>

      <div class="card" *ngIf="loading">
        <div class="card-body d-flex justify-content-center py-20">
          <div class="spinner-border text-primary" role="status"></div>
        </div>
      </div>

      <div class="card" *ngIf="!loading && rfx">
        <div class="card-body">
          <div class="row mb-6">
            <div class="col-md-8">
              <div class="d-flex align-items-center gap-4 mb-2">
                <div>
                  <div class="text-muted">Reference</div>
                  <div class="fs-4 fw-bold">{{ rfx.referenceNumber }}</div>
                </div>
                <div>
                  <div class="text-muted">Status</div>
                  <div class="badge fw-semibold" [ngClass]="{
                      'badge-light-warning': rfx.status === 'Draft',
                      'badge-light-success': rfx.status === 'Published',
                      'badge-light-danger': rfx.status === 'Closed'
                    }">
                    {{ rfx.status }}
                  </div>
                </div>
              </div>
              <h3 class="fw-bold text-gray-800 mb-1">{{ rfx.title }}</h3>
              <div class="text-muted mb-3">{{ rfx.description }}</div>
              <div class="d-flex flex-wrap gap-4 text-muted">
                <div><strong>Category:</strong> {{ rfx.category }}</div>
                <div><strong>Department:</strong> {{ rfx.department }}</div>
                <div><strong>Type:</strong> {{ rfx.rfxType }}</div>
              </div>
            </div>
            <div class="col-md-4 border-start">
              <div class="ps-md-5">
                <div class="d-flex justify-content-between mb-2">
                  <span class="text-muted">Publication</span>
                  <span class="fw-semibold">{{ rfx.publicationDate | date: 'mediumDate' }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span class="text-muted">Closing</span>
                  <span class="fw-semibold">{{ rfx.closingDate | date: 'mediumDate' }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span class="text-muted">Submission Deadline</span>
                  <span class="fw-semibold">{{ rfx.submissionDeadline | date: 'short' }}</span>
                </div>
                <div class="d-flex justify-content-between">
                  <span class="text-muted">Estimated Budget</span>
                  <span class="fw-semibold">{{ rfx.estimatedBudget | currency: rfx.currency : 'symbol-narrow' : '1.0-0' }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="separator mb-6"></div>

          <div class="row g-6">
            <div class="col-lg-6">
              <h5 class="fw-bold mb-3">Requirements</h5>
              <div class="detail-block">
                <div><strong>Scope:</strong> {{ rfx.scope }}</div>
                <div><strong>Technical Specification:</strong> {{ rfx.technicalSpecification }}</div>
                <div><strong>Deliverables:</strong> {{ rfx.deliverables }}</div>
                <div><strong>Timeline:</strong> {{ rfx.timeline }}</div>
                <div><strong>Required Documents:</strong> {{ rfx.requiredDocuments.join(', ') || 'None specified' }}</div>
              </div>
            </div>
            <div class="col-lg-6">
              <h5 class="fw-bold mb-3">Evaluation</h5>
              <div class="detail-block" *ngIf="hasEvaluation; else noCriteria">
                <div class="d-flex justify-content-between text-muted mb-2">
                  <span>Minimum Score</span>
                  <span class="fw-semibold">{{ rfx.minimumScore }}%</span>
                </div>
                <div class="mb-3">
                  <div *ngFor="let criterion of rfx.evaluationCriteria" class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                      <div class="fw-semibold">{{ criterion.title }}</div>
                      <div class="text-muted">{{ criterion.description }}</div>
                    </div>
                    <span class="badge badge-light-primary">{{ criterion.weight }} pts</span>
                  </div>
                </div>
                <div *ngIf="rfx.evaluationNotes" class="alert alert-secondary mb-0">{{ rfx.evaluationNotes }}</div>
              </div>
              <ng-template #noCriteria>
                <div class="detail-block text-muted">No evaluation criteria configured.</div>
              </ng-template>
            </div>
          </div>

          <div class="separator my-6"></div>

          <div>
            <h5 class="fw-bold mb-3">Tender Committee</h5>
            <div class="detail-block" *ngIf="hasCommittee; else noCommittee">
              <div class="d-flex flex-wrap gap-3">
                <div *ngFor="let member of rfx?.committeeMembers" class="badge badge-light-info py-3 px-4">
                  {{ member.displayName }}
                </div>
              </div>
            </div>
            <ng-template #noCommittee>
              <div class="detail-block text-muted">No committee members assigned.</div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
