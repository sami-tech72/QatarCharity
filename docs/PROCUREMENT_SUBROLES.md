# Procurement sub-role claims

Procurement permissions are driven by claims on the procurement user rather than a fixed list of sub-role names. Each claim uses the type `procurement_sub_role` and a value in the format:

```
<RoleName>|view,create,update,delete
```

* `RoleName` can be any string (for example, `ProcurementReviewer` or `ContractApprover`).
* The permission segment is a comma-separated list containing any combination of `view`, `create`, `update`, and `delete`.
* If the permission segment is omitted (just `RoleName`), built-in defaults are applied for the predefined names (`ProcurementViewer`, `ProcurementContributor`, `ProcurementManager`).

## Seeding or adding claims

The seeder (`src/Persistence/Seed/DatabaseSeeder.cs`) shows how to add claims for the default procurement account. It uses `ProcurementPermissionCalculator.ToClaimValue` to format the claim value so you only need to specify the permissions:

```csharp
var defaultSubRoles = new Dictionary<string, ProcurementPermissionSet>
{
    [ProcurementSubRoles.Manager] = new(CanView: true, CanCreate: true, CanUpdate: true, CanDelete: true),
    ["ProcurementReviewer"] = new(CanView: true, CanUpdate: true),
};

await userManager.AddClaimAsync(
    procurementUser,
    new Claim(CustomClaimTypes.ProcurementSubRole, ProcurementPermissionCalculator.ToClaimValue("ProcurementReviewer", defaultSubRoles["ProcurementReviewer"])));
```

To grant a new sub-role to any procurement user, add a claim with the `procurement_sub_role` type and a value generated by `ProcurementPermissionCalculator.ToClaimValue`. The permissions will automatically be merged and surfaced in the login response (`procurementSubRoles` and `procurementPermissions`) for the frontend guard to enforce.

## Frontend enforcement

The login response exposes `procurementSubRoles` (an array of strings) and `procurementPermissions` (a merged set of `canView`, `canCreate`, `canUpdate`, `canDelete`). Angular's route guard (`frontend/src/app/core/guards/auth.guard.ts`) checks `data.procurementPermission` on procurement routes and redirects users who do not have the required permission bit. Because `procurementSubRoles` accepts any string, you can introduce new procurement sub-role names in the backend claims without touching the frontendâ€”only the permissions matter for access control.
